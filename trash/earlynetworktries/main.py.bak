from sumo_rl import SumoEnvironment

# 1. Initialisieren, um TLS-IDs zu ermitteln
env_probe = SumoEnvironment(
    net_file="karlsruhe.net.xml",
    route_file="karlsruhe.rou.xml",
    use_gui=False,
    single_agent=True
)

print("Gefundene Ampeln:", env_probe.ts_ids)
valid_tls_ids = env_probe.ts_ids
env_probe.close()

# 2. Neuen SumoEnvironment erstellen mit genau **einer** Ampel (workaround!)
env = SumoEnvironment(
    net_file="karlsruhe.net.xml",
    route_file="karlsruhe.rou.xml",
    use_gui=True,
    single_agent=True,
    reward_fn="diff-waiting-time",
    delta_time=5,
    yellow_time=2,
    min_green=5
)

print("Steuere folgende TLS:", env.ts_ids)

for episode in range(1):
    obs = env.reset()
    done = False
    total_reward = 0

    while not done:
        action = env.action_space.sample()
        obs, reward, done, _, _ = env.step(action)
        total_reward += reward

    print("Episode finished with reward:", total_reward)
